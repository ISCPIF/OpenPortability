FROM node:24-alpine

WORKDIR /app

ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
ENV WATCHPACK_POLLING=true
ENV CHOKIDAR_USEPOLLING=true
ENV CHOKIDAR_INTERVAL=1000
ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

# Copie package files
COPY package*.json ./

# Créer les dossiers nécessaires avec les bonnes permissions
# Ces dossiers seront les points de montage des volumes
RUN mkdir -p /app/.next /app/node_modules /app/tmp /app/logs \
    && chown -R node:node /app

USER node

# Installer les dépendances
RUN npm install

EXPOSE 3000

CMD ["npm", "run", "dev", "--", "--port", "3000", "--hostname", "0.0.0.0"]